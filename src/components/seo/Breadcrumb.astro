---
/**
 * Breadcrumb.astro
 * パンくずリストコンポーネント（構造化データ付き）
 *
 * 使用例:
 * <Breadcrumb items={[
 *   { name: 'ホーム', href: '/' },
 *   { name: 'サービス', href: '/services/' },
 *   { name: 'DX推進サポート', href: '/services/dx-consulting/' }
 * ]} />
 */

import type { BreadcrumbProps, BreadcrumbItem } from '@shared/contracts/components';
import type { BreadcrumbItemSchema } from '@shared/contracts/api';

interface Props extends BreadcrumbProps {
  showHome?: boolean;
  separator?: string;
}

const {
  items,
  showHome = true,
  separator = '/'
} = Astro.props;

import { siteMetadata } from '../../lib/siteConfig';
const siteUrl = siteMetadata.siteUrl;

// ホームを先頭に追加
const breadcrumbItems: BreadcrumbItem[] = showHome && items[0]?.href !== '/'
  ? [{ name: 'ホーム', href: '/' }, ...items]
  : items;

// 構造化データ生成
const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: breadcrumbItems.map((item, index): BreadcrumbItemSchema => ({
    '@type': 'ListItem',
    position: index + 1,
    name: item.name,
    item: index < breadcrumbItems.length - 1
      ? new URL(item.href, siteUrl).href
      : undefined
  }))
};
---

<nav class="breadcrumb" aria-label="パンくずリスト">
  <ol class="breadcrumb__list">
    {breadcrumbItems.map((item, index) => (
      <li class="breadcrumb__item">
        {index < breadcrumbItems.length - 1 ? (
          <>
            <a href={item.href} class="breadcrumb__link">
              {index === 0 && showHome && item.href === '/' ? (
                <span class="breadcrumb__home-icon" aria-hidden="true">
                  <!-- Home icon -->
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                  </svg>
                </span>
              ) : null}
              <span>{item.name}</span>
            </a>
            <span class="breadcrumb__separator" aria-hidden="true">{separator}</span>
          </>
        ) : (
          <span class="breadcrumb__current" aria-current="page">{item.name}</span>
        )}
      </li>
    ))}
  </ol>
</nav>

<!-- 構造化データ -->
<script
  type="application/ld+json"
  set:html={JSON.stringify(structuredData, null, 0)}
/>

<style>
  .breadcrumb {
    padding: 0.75rem 0;
    font-size: 0.875rem;
  }

  .breadcrumb__list {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .breadcrumb__item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .breadcrumb__link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    color: var(--gray);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .breadcrumb__link:hover {
    color: var(--primary);
    text-decoration: underline;
  }

  .breadcrumb__home-icon {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .breadcrumb__separator {
    color: var(--gray-light);
    user-select: none;
  }

  .breadcrumb__current {
    color: var(--dark);
    font-weight: 500;
  }

  /* レスポンシブ */
  @media (max-width: 768px) {
    .breadcrumb {
      font-size: 0.75rem;
    }

    .breadcrumb__list {
      gap: 0.375rem;
    }

    .breadcrumb__item {
      gap: 0.375rem;
    }

    /* モバイルでは中間の項目を省略可能 */
    .breadcrumb__item:not(:first-child):not(:last-child):not(:nth-last-child(2)) {
      display: none;
    }

    /* 省略記号を表示 */
    .breadcrumb__item:nth-last-child(3)::before {
      content: '...';
      color: var(--gray-light);
      margin-right: 0.375rem;
    }
  }
</style>

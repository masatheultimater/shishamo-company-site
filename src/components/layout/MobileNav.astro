---
/**
 * MobileNav Component
 * Full-screen mobile navigation with staggered animations
 */
import { navigationItems, socialLinks } from '../../lib/siteConfig';
import XIcon from '../ui/XIcon.astro';
---

<nav class="mobile-nav" id="mobileNav" aria-label="Mobile navigation">
  <div class="mobile-nav__accent"></div>

  <button
    class="mobile-nav__close"
    id="mobileNavClose"
    aria-label="メニューを閉じる"
  >
    <svg
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
      stroke-linejoin="round"
      aria-hidden="true"
    >
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>

  <div class="mobile-nav__content">
    <div class="mobile-nav__links">
      {
        navigationItems.map((item, i) => (
          <a
            href={item.href}
            class="mobile-nav__link"
            style={`--stagger: ${i}`}
          >
            {item.title}
          </a>
        ))
      }
      <a
        href="/contact/"
        class="mobile-nav__cta"
        style={`--stagger: ${navigationItems.length}`}
      >
        お問い合わせ
      </a>
    </div>

    <div class="mobile-nav__footer">
      <div class="mobile-nav__social">
        <a
          href={socialLinks.x.url}
          target="_blank"
          rel="noopener noreferrer"
          class="mobile-nav__social-link"
          aria-label={socialLinks.x.label}
        >
          <XIcon size={16} />
        </a>
      </div>

      <div
        class="mobile-nav__font-size"
        role="group"
        aria-label="文字サイズ調整"
      >
        <span class="mobile-nav__font-size-label">文字サイズ</span>
        <div class="mobile-nav__font-size-buttons">
          <button
            class="font-size-btn"
            data-font-size-level="small"
            aria-label="文字サイズ: 小（標準）"
            aria-pressed="true"
          >
            <span class="font-size-btn__text font-size-btn__text--small"
              >小</span
            >
          </button>
          <button
            class="font-size-btn"
            data-font-size-level="medium"
            aria-label="文字サイズ: 中"
            aria-pressed="false"
          >
            <span class="font-size-btn__text font-size-btn__text--medium"
              >中</span
            >
          </button>
          <button
            class="font-size-btn"
            data-font-size-level="large"
            aria-label="文字サイズ: 大"
            aria-pressed="false"
          >
            <span class="font-size-btn__text font-size-btn__text--large"
              >大</span
            >
          </button>
          <button
            class="font-size-btn"
            data-font-size-level="xlarge"
            aria-label="文字サイズ: 特大"
            aria-pressed="false"
          >
            <span class="font-size-btn__text font-size-btn__text--xlarge"
              >特大</span
            >
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  function initMobileNav() {
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    const mobileNavClose = document.getElementById('mobileNavClose');

    if (!mobileMenuBtn || !mobileNav) return;

    function openMenu() {
      mobileNav.classList.add('mobile-nav--active');
      mobileMenuBtn.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
      mobileNavClose?.focus();
    }

    function closeMenu() {
      mobileNav.classList.remove('mobile-nav--active');
      mobileMenuBtn.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
      mobileMenuBtn.focus();
    }

    mobileMenuBtn.addEventListener('click', () => {
      const isOpen = mobileNav.classList.contains('mobile-nav--active');
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    mobileNavClose?.addEventListener('click', closeMenu);

    mobileNav.addEventListener('click', (e) => {
      if (e.target === mobileNav) {
        closeMenu();
      }
    });

    mobileNav.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });

    document.addEventListener('keydown', (e) => {
      if (
        e.key === 'Escape' &&
        mobileNav.classList.contains('mobile-nav--active')
      ) {
        closeMenu();
      }
    });
  }

  initMobileNav();
  document.addEventListener('astro:page-load', initMobileNav);
</script>

<style>
  /* ===== MOBILE NAV — Animated Glass Overlay ===== */
  .mobile-nav {
    position: fixed;
    inset: 0;
    background: var(--color-overlay-bg);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    z-index: 105;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease;
  }

  .mobile-nav--active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  /* Accent gradient line at top */
  .mobile-nav__accent {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-semantic-accent);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease 0.1s;
  }

  .mobile-nav--active .mobile-nav__accent {
    transform: scaleX(1);
  }

  /* Close button — minimal */
  .mobile-nav__close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition:
      color 0.2s ease,
      background 0.2s ease;
    z-index: 1;
  }

  .mobile-nav__close:hover,
  .mobile-nav__close:focus {
    color: var(--color-accent);
    background: color-mix(in srgb, var(--color-accent) 10%, transparent);
    outline: none;
  }

  .mobile-nav__close:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  /* Content layout */
  .mobile-nav__content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 48px;
    max-height: 100vh;
    overflow-y: auto;
    padding: 80px 24px 40px;
    width: 100%;
  }

  /* Nav links group */
  .mobile-nav__links {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  /* Staggered slide-up animation */
  .mobile-nav__link,
  .mobile-nav__cta {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 0.35s ease,
      transform 0.35s ease,
      color 0.2s ease;
    transition-delay: calc(var(--stagger, 0) * 0.06s + 0.1s);
  }

  .mobile-nav--active .mobile-nav__link,
  .mobile-nav--active .mobile-nav__cta {
    opacity: 1;
    transform: translateY(0);
  }

  .mobile-nav__link {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-heading);
    padding: 12px 32px;
    border-radius: var(--radius-sm);
    text-decoration: none;
  }

  .mobile-nav__link:hover,
  .mobile-nav__link:focus {
    color: var(--color-accent);
    outline: none;
  }

  .mobile-nav__cta {
    margin-top: 16px;
    padding: 14px 40px;
    font-size: var(--font-size-lg);
    font-weight: 600;
    background: var(--gradient-semantic-primary);
    color: var(--palette-white);
    border-radius: var(--radius-sm);
    text-decoration: none;
    box-shadow: var(--shadow-semantic-md);
  }

  .mobile-nav__cta:hover,
  .mobile-nav__cta:focus {
    transform: translateY(-2px);
    box-shadow: var(--shadow-semantic-lg), var(--shadow-semantic-glow);
    outline: none;
  }

  /* Footer section */
  .mobile-nav__footer {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    opacity: 0;
    transition: opacity 0.3s ease 0.35s;
  }

  .mobile-nav--active .mobile-nav__footer {
    opacity: 1;
  }

  /* Social — icon-only pills */
  .mobile-nav__social {
    display: flex;
    gap: 12px;
  }

  .mobile-nav__social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    color: var(--color-text-secondary);
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    transition:
      color 0.2s ease,
      background 0.2s ease,
      border-color 0.2s ease;
  }

  .mobile-nav__social-link:hover,
  .mobile-nav__social-link:focus {
    color: var(--palette-white);
    background: var(--color-accent);
    border-color: var(--color-accent);
    outline: none;
  }

  /* Font Size Control — pill style */
  .mobile-nav__font-size {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .mobile-nav__font-size-label {
    font-size: 12px;
    color: var(--color-text-muted);
    font-weight: 500;
  }

  .mobile-nav__font-size-buttons {
    display: flex;
    gap: 4px;
    background: var(--color-surface);
    border-radius: var(--radius-full);
    padding: 3px;
    border: 1px solid var(--color-border);
  }

  .mobile-nav__font-size-buttons .font-size-btn {
    background: transparent;
    border: none;
    min-width: 40px;
    min-height: 36px;
    border-radius: var(--radius-full);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition:
      background 0.2s ease,
      color 0.2s ease;
    color: var(--color-text-muted);
  }

  .mobile-nav__font-size-buttons .font-size-btn:hover,
  .mobile-nav__font-size-buttons .font-size-btn:focus {
    color: var(--color-text-heading);
    outline: none;
  }

  .mobile-nav__font-size-buttons .font-size-btn:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 1px;
  }

  .mobile-nav__font-size-buttons .font-size-btn.font-size-btn--active {
    background: var(--color-accent);
    color: var(--palette-white);
  }

  /* Button text sizes in px (must NOT self-scale) */
  .font-size-btn__text {
    font-weight: 600;
    line-height: 1;
  }
  .font-size-btn__text--small {
    font-size: 11px;
  }
  .font-size-btn__text--medium {
    font-size: 13px;
  }
  .font-size-btn__text--large {
    font-size: 15px;
  }
  .font-size-btn__text--xlarge {
    font-size: 17px;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .mobile-nav {
      transition: none;
    }
    .mobile-nav__accent {
      transition: none;
    }
    .mobile-nav__link,
    .mobile-nav__cta {
      transition: none;
      transition-delay: 0s;
    }
    .mobile-nav__footer {
      transition: none;
    }
    .mobile-nav--active .mobile-nav__link,
    .mobile-nav--active .mobile-nav__cta {
      opacity: 1;
      transform: none;
    }
    .mobile-nav--active .mobile-nav__footer {
      opacity: 1;
    }
    .mobile-nav--active .mobile-nav__accent {
      transform: scaleX(1);
    }
  }
</style>

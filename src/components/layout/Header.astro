---
/**
 * Header Component
 * Implements HeaderProps from shared/contracts/components.ts
 */
import { siteBranding, navigationItems } from '../../lib/siteConfig';
import Logo from '../ui/Logo.astro';
import { Sun, Moon, Menu } from '@lucide/astro';

interface Props {
  currentPage?: 'home' | 'services' | 'profile' | 'blog' | 'contact';
  transparent?: boolean;
}

const { currentPage, transparent = false } = Astro.props;
---

<header class:list={["header", { "header--transparent": transparent }]}>
  <div class="header-inner">
    <div class="logo-group">
      <a href="/" class="logo">
        <div class="logo-mark">
          <Logo />
        </div>
        <div class="logo-text">
          {siteBranding.clientName}
        </div>
      </a>
      <a href="https://x.com/shishamoex09" target="_blank" rel="noopener noreferrer" class="header-x-link" aria-label="X @shishamoex09">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
        </svg>
      </a>
      <a href="https://www.facebook.com/shishamo.company/" target="_blank" rel="noopener noreferrer" class="header-fb-link" aria-label="Facebookページ">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M13.5 9.2V7.6c0-.7.5-1.2 1.2-1.2h1.9V3.2h-2.2c-2.6 0-4.2 1.7-4.2 4.2v1.8H8v3.1h2.2v8.5h3.3v-8.5h2.8l.4-3.1z"/>
        </svg>
      </a>
    </div>

    <nav class="nav" aria-label="Main navigation">
      {navigationItems.map((item) => (
        <a
          href={item.href}
          class:list={["nav-link", { "nav-link--active": currentPage === item.slug }]}
        >
          {item.title}
        </a>
      ))}
      <a href="/contact/" class:list={["nav-cta", { "nav-cta--active": currentPage === 'contact' }]}>
        無料相談
      </a>
      <button class="theme-toggle" id="themeToggle" aria-label="テーマ切り替え">
        <Sun class="theme-icon theme-icon--light" size={18} />
        <Moon class="theme-icon theme-icon--dark" size={18} />
      </button>
    </nav>

    <div class="header-actions">
      <button class="theme-toggle theme-toggle--mobile" id="themeToggleMobile" aria-label="テーマ切り替え">
        <Sun class="theme-icon theme-icon--light" size={18} />
        <Moon class="theme-icon theme-icon--dark" size={18} />
      </button>
      <button
        class="mobile-menu-btn"
        aria-label="メニューを開く"
        aria-expanded="false"
        aria-controls="mobileNav"
        id="mobileMenuBtn"
      >
        <Menu size={20} />
      </button>
    </div>
  </div>
</header>

<style>
  /* ===== HEADER — Glass Navbar ===== */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: var(--color-glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--color-glass-border);
    padding: 0 24px;
  }

  .header--transparent {
    background: transparent;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-bottom: none;
  }

  .header-inner {
    max-width: var(--container-lg);
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 72px;
  }

  /* Logo Group */
  .logo-group {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 0;
  }

  .logo-mark {
    width: 56px;
    height: 36px;
    background: var(--color-accent);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--palette-white);
    padding: 6px 8px;
  }

  .logo-mark :global(svg) {
    width: 100%;
    height: 100%;
  }

  .logo-text {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 18px;
    color: var(--color-text-heading);
    white-space: nowrap;
  }

  /* Social Links */
  .header-x-link,
  .header-fb-link {
    width: 32px;
    height: 32px;
    background: var(--color-surface-elevated);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--color-text-secondary);
    transition: all var(--transition-base);
  }

  .header-x-link:hover,
  .header-fb-link:hover {
    background: var(--color-accent);
    color: var(--palette-white);
  }

  .header-x-link:focus-visible,
  .header-fb-link:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  /* Navigation */
  .nav {
    display: flex;
    align-items: center;
    gap: 28px;
  }

  .nav-link {
    font-size: 14px;
    font-weight: 500;
    color: var(--color-text-secondary);
    transition: color var(--transition-base);
    padding: 8px 0;
  }

  .nav-link:hover,
  .nav-link--active {
    color: var(--color-text-heading);
  }

  .nav-cta {
    background: var(--gradient-semantic-primary);
    color: var(--palette-white);
    padding: 10px 20px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    transition: all var(--transition-base);
  }

  .nav-cta:hover {
    box-shadow: var(--color-btn-primary-hover-shadow);
  }

  /* Theme Toggle */
  .theme-toggle {
    background: var(--color-surface-elevated);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background var(--transition-base);
    position: relative;
  }

  .theme-toggle:hover {
    background: var(--color-surface-hover);
  }

  .theme-icon {
    position: absolute;
    transition: opacity var(--transition-base), transform var(--transition-base);
    color: var(--color-text-secondary);
  }

  .theme-icon--light {
    opacity: 1;
    transform: scale(1);
  }

  .theme-icon--dark {
    opacity: 0;
    transform: scale(0.8);
  }

  :global([data-theme="light"]) .theme-icon--light {
    opacity: 1;
    transform: scale(1);
  }

  :global([data-theme="light"]) .theme-icon--dark {
    opacity: 0;
    transform: scale(0.8);
  }

  :global([data-theme="dark"]) .theme-icon--light {
    opacity: 0;
    transform: scale(0.8);
  }

  :global([data-theme="dark"]) .theme-icon--dark {
    opacity: 1;
    transform: scale(1);
  }

  .theme-toggle--mobile {
    display: none;
  }

  /* Header Actions */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Mobile Menu Button */
  .mobile-menu-btn {
    display: none;
    background: var(--color-surface-elevated);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    color: var(--color-text-secondary);
    align-items: center;
    justify-content: center;
    transition: background var(--transition-base);
  }

  .mobile-menu-btn:hover {
    background: var(--color-surface-hover);
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .header-inner {
      height: 64px;
    }

    .nav {
      display: none;
    }

    .mobile-menu-btn {
      display: flex;
    }

    .theme-toggle--mobile {
      display: flex;
    }

    .header-x-link,
    .header-fb-link {
      display: none;
    }
  }

  @media (max-width: 480px) {
    .header {
      padding: 0 16px;
    }

    .logo-mark {
      width: 48px;
      height: 30px;
      padding: 5px 6px;
    }

    .logo-text {
      font-size: 15px;
    }

    .logo-group {
      gap: 10px;
    }
  }
</style>

<script>
  import '../../scripts/theme';
</script>

---
/**
 * Header Component
 * Implements HeaderProps from shared/contracts/components.ts
 */
import { siteBranding, navigationItems } from '../../lib/siteConfig';
import Logo from '../ui/Logo.astro';

interface Props {
  currentPage?: 'home' | 'services' | 'profile' | 'blog' | 'contact';
  transparent?: boolean;
}

const { currentPage, transparent = false } = Astro.props;
---

<header class:list={["header", { "header--transparent": transparent }]}>
  <div class="header-inner">
    <div class="logo-group">
      <a href="/" class="logo">
        <div class="logo-mark">
          <Logo />
        </div>
        <div class="logo-text">
          {siteBranding.clientName}
        </div>
      </a>
      <a href="https://x.com/shishamoex09" target="_blank" rel="noopener noreferrer" class="header-x-link" aria-label="X @shishamoex09">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
        </svg>
      </a>
      <a href="https://www.facebook.com/shishamo.company/" target="_blank" rel="noopener noreferrer" class="header-fb-link" aria-label="Facebookページ">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M13.5 9.2V7.6c0-.7.5-1.2 1.2-1.2h1.9V3.2h-2.2c-2.6 0-4.2 1.7-4.2 4.2v1.8H8v3.1h2.2v8.5h3.3v-8.5h2.8l.4-3.1z"/>
        </svg>
      </a>
    </div>

    <nav class="nav" aria-label="Main navigation">
      {navigationItems.map((item) => (
        <a
          href={item.href}
          class:list={["nav-link", { "nav-link--active": currentPage === item.slug }]}
        >
          {item.title}
        </a>
      ))}
      <a href="/contact/" class:list={["nav-cta", { "nav-cta--active": currentPage === 'contact' }]}>
        無料相談
      </a>
      <button class="theme-toggle" id="themeToggle" aria-label="テーマ切り替え">
        <svg class="theme-icon theme-icon--light" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4"/>
          <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
        </svg>
        <svg class="theme-icon theme-icon--dark" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
        </svg>
      </button>
    </nav>

    <div class="header-actions">
      <button class="theme-toggle theme-toggle--mobile" id="themeToggleMobile" aria-label="テーマ切り替え">
        <svg class="theme-icon theme-icon--light" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4"/>
          <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
        </svg>
        <svg class="theme-icon theme-icon--dark" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
        </svg>
      </button>
      <button
        class="mobile-menu-btn"
        aria-label="メニューを開く"
        aria-expanded="false"
        aria-controls="mobileNav"
        id="mobileMenuBtn"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<style>
  /* ===== HEADER ===== */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: var(--gray-50);
    border-bottom: 1px solid var(--gray-200);
    padding: 0 24px;
  }

  .header--transparent {
    background: transparent;
    border-bottom: none;
  }

  .header-inner {
    max-width: var(--container-lg);
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 72px;
  }

  /* Logo Group */
  .logo-group {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-mark {
    width: 56px;
    height: 36px;
    background: var(--primary);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--btn-text-on-primary);
    padding: 6px 8px;
  }

  .logo-mark svg {
    width: 100%;
    height: 100%;
  }

  :global([data-theme="dark"]) .logo-mark {
    color: var(--btn-text-on-primary-dark);
  }

  .logo-text {
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 18px;
    color: var(--dark);
  }

  .logo-sub {
    color: var(--gray-500);
    font-weight: 500;
    font-size: 13px;
    margin-left: 8px;
  }

  /* X Link */
  .header-x-link {
    width: 32px;
    height: 32px;
    background: var(--gray-200);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--gray-600);
    transition: all 0.2s;
  }

  .header-x-link:hover {
    background: var(--dark);
    color: var(--white);
    opacity: 0.85;
  }

  :global([data-theme="dark"]) .header-x-link:hover {
    background: var(--gray-300);
    color: var(--dark);
  }

  .header-x-link:focus-visible,
  .header-fb-link:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  .header-fb-link {
    width: 32px;
    height: 32px;
    background: var(--gray-200);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--gray-600);
    transition: all 0.2s;
  }

  .header-fb-link:hover {
    background: var(--dark);
    color: var(--white);
    opacity: 0.85;
  }

  :global([data-theme="dark"]) .header-fb-link:hover {
    background: var(--gray-300);
    color: var(--dark);
  }

  /* Navigation */
  .nav {
    display: flex;
    align-items: center;
    gap: 28px;
  }

  .nav-link {
    font-size: 14px;
    font-weight: 500;
    color: var(--gray-600);
    transition: color 0.2s;
    padding: 8px 0;
  }

  .nav-link:hover,
  .nav-link--active {
    color: var(--dark);
  }

  .nav-cta {
    background: var(--primary);
    color: var(--btn-text-on-primary);
    padding: 10px 20px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
  }

  .nav-cta:hover {
    background: var(--primary-light);
  }

  :global([data-theme="dark"]) .nav-cta {
    color: var(--btn-text-on-primary-dark);
  }

  /* Theme Toggle */
  .theme-toggle {
    background: var(--gray-200);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    position: relative;
  }

  .theme-toggle:hover {
    background: var(--gray-300);
  }

  .theme-icon {
    position: absolute;
    transition: opacity 0.2s, transform 0.2s;
    color: var(--gray-600);
  }

  .theme-icon--light {
    opacity: 1;
    transform: scale(1);
  }

  .theme-icon--dark {
    opacity: 0;
    transform: scale(0.8);
  }

  /* Dark mode theme icon states */
  :global([data-theme="light"]) .theme-icon--light {
    opacity: 1;
    transform: scale(1);
  }

  :global([data-theme="light"]) .theme-icon--dark {
    opacity: 0;
    transform: scale(0.8);
  }

  :global([data-theme="dark"]) .theme-icon--light {
    opacity: 0;
    transform: scale(0.8);
  }

  :global([data-theme="dark"]) .theme-icon--dark {
    opacity: 1;
    transform: scale(1);
  }

  .theme-toggle--mobile {
    display: none;
  }

  /* Header Actions */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Mobile Menu Button */
  .mobile-menu-btn {
    display: none;
    background: var(--gray-200);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    color: var(--gray-600);
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }

  .mobile-menu-btn:hover {
    background: var(--gray-300);
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .header-inner {
      height: 64px;
    }

    .nav {
      display: none;
    }

    .mobile-menu-btn {
      display: flex;
    }

    .theme-toggle--mobile {
      display: flex;
    }
  }

  @media (max-width: 480px) {
    .header {
      padding: 0 16px;
    }

    .logo-mark {
      width: 48px;
      height: 30px;
      padding: 5px 6px;
    }

    .logo-text {
      font-size: 16px;
    }

    .logo-sub {
      display: none;
    }

    .logo-group {
      gap: 12px;
    }

    .header-x-link {
      width: 28px;
      height: 28px;
    }

    .header-x-link svg {
      width: 12px;
      height: 12px;
    }

    .header-fb-link {
      width: 28px;
      height: 28px;
    }

    .header-fb-link svg {
      width: 12px;
      height: 12px;
    }
  }
</style>

<script>
  import '../../scripts/theme';
</script>

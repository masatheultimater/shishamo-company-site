---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import profileImage from '../assets/images/profile.jpg';
import ArrowIcon from '../components/ui/ArrowIcon.astro';
import { getAllBlogPosts, categoryLabels, categoryIcons, getPrimaryCategory, formatDate, transformBlogPost } from '../lib/microcms';
import '../styles/home.css';

const allPosts = await getAllBlogPosts();
const latestPosts = allPosts.map(transformBlogPost).slice(0, 3);
---

<Layout
  title="ししゃもカンパニー - IT × 経営 × 財務"
  description="中小企業の伴走パートナー「ししゃもカンパニー」。DX推進・生成AI導入・データ活用・経営支援で、御社の挑戦を後押しします。"
  currentPage="home"
>
  <!-- HERO -->
  <section class="hero hero--bg-full">
    <div class="hero-inner">
      <div class="hero-content">
        <div class="hero-badge">中小企業診断士(登録予定) × ITストラテジスト</div>
        <h1 class="hero-title">
          IT・データ・財務の力で<br>
          <span class="highlight">経営の課題</span>を解決します
        </h1>
        <p class="hero-desc">
          Web開発12年、会計事務所1年の経験を活かし、DX推進から経営改善まで。
          中小企業の「なんとかしたい」に寄り添い、伴走支援いたします。
        </p>
        <div class="hero-cta">
          <a href="/contact/" class="btn-primary" data-track-cta="hero">無料相談を予約する <ArrowIcon size={14} /></a>
          <a href="/services/" class="btn-secondary" data-track-cta="hero">サービス一覧を見る</a>
        </div>
      </div>
      <div class="profile-card">
        <div class="profile-photo">
          <Image src={profileImage} alt="吉川昌宏" width={200} height={200} loading="eager" />
        </div>
        <div class="profile-social-list">
          <a href="https://x.com/shishamoex09" target="_blank" rel="noopener noreferrer" class="profile-social-link">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
            <span>@shishamoex09</span>
          </a>
          <a href="https://www.facebook.com/shishamo.company/" target="_blank" rel="noopener noreferrer" class="profile-social-link">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M13.5 9.2V7.6c0-.7.5-1.2 1.2-1.2h1.9V3.2h-2.2c-2.6 0-4.2 1.7-4.2 4.2v1.8H8v3.1h2.2v8.5h3.3v-8.5h2.8l.4-3.1z"/>
            </svg>
            <span>ししゃもカンパニー</span>
          </a>
        </div>
        <div class="profile-name">吉川 昌宏</div>
        <div class="profile-title">中小企業診断士(登録予定) / ITストラテジスト</div>
        <p class="profile-intro">
          エンジニアと会計、両方の現場経験あり。本当に必要なことを見極めて、わかりやすく提案します。
        </p>
        <div class="profile-stats">
          <div class="stat-item">
            <div class="stat-value">12<span class="stat-unit">年</span></div>
            <div class="stat-label">システム開発</div>
            <div class="stat-tooltip">
              <ul>
                <li>Webアプリケーション開発</li>
                <li>業務システム設計・構築</li>
                <li>データベース設計・運用</li>
                <li>API開発・連携</li>
              </ul>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-value">1<span class="stat-unit">年</span></div>
            <div class="stat-label">会計事務所</div>
            <div class="stat-tooltip">
              <ul>
                <li>記帳代行・月次決算</li>
                <li>法人・個人の税務申告</li>
                <li>経営分析・財務アドバイス</li>
              </ul>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-value">6<span class="stat-unit">+</span></div>
            <div class="stat-label">国家資格</div>
            <div class="stat-tooltip">
              <ul>
                <li>中小企業診断士(登録予定)</li>
                <li>税理士科目合格(簿記論)</li>
                <li>ITストラテジスト</li>
                <li>データベーススペシャリスト</li>
                <li>応用情報技術者</li>
                <li>E資格（JDLA認定）</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUICK ACCESS -->
  <section class="quick-access">
    <div class="quick-cards">
      <a href="/services/" class="quick-card">
        <span class="quick-icon">🚀</span>
        <span class="quick-label">サービス</span>
        <span class="quick-desc">何ができる？</span>
      </a>
      <a href="/profile/" class="quick-card">
        <span class="quick-icon">👤</span>
        <span class="quick-label">プロフィール</span>
        <span class="quick-desc">どんな人？</span>
      </a>
      <a href="/contact/" class="quick-card">
        <span class="quick-icon">💬</span>
        <span class="quick-label">お問い合わせ</span>
        <span class="quick-desc">相談したい</span>
      </a>
    </div>
  </section>

  <!-- PROBLEMS -->
  <section class="section problems">
    <div class="container">
      <div class="section-header section-header--compact">
        <div class="section-label section-label--compact">Problems</div>
        <h2 class="section-title section-title--compact">こんなお悩みはありませんか？</h2>
        <p class="section-desc section-desc--compact">一つでも当てはまれば、お力になれるかもしれません</p>
      </div>
      <div class="problem-grid">
        <a href="/services/#dx" class="problem-card">
          <span class="problem-text">DXって何から始めればいいかわからない</span>
          <ArrowIcon class="problem-arrow" />
        </a>
        <a href="/services/#ai" class="problem-card">
          <span class="problem-text">ChatGPTを業務に活用したい</span>
          <ArrowIcon class="problem-arrow" />
        </a>
        <a href="/services/#data" class="problem-card">
          <span class="problem-text">データはあるけど活用できていない</span>
          <ArrowIcon class="problem-arrow" />
        </a>
        <a href="/services/#accounting" class="problem-card">
          <span class="problem-text">経理業務の負担を減らしたい</span>
          <ArrowIcon class="problem-arrow" />
        </a>
        <a href="/services/#management" class="problem-card">
          <span class="problem-text">経営を客観的に分析してほしい</span>
          <ArrowIcon class="problem-arrow" />
        </a>
        <a href="/services/#subsidy" class="problem-card">
          <span class="problem-text">補助金を使いたいが申請が難しい</span>
          <ArrowIcon class="problem-arrow" />
        </a>
      </div>
      <div class="problem-cta">
        <p>どれに当てはまるかわからなくても大丈夫です。まずはお気軽にご相談ください。</p>
        <a href="/contact/" class="btn-primary" data-track-cta="problems">無料相談を予約する <ArrowIcon size={14} /></a>
      </div>
    </div>
  </section>

  <!-- SERVICES -->
  <section class="section services">
    <div class="container">
      <div class="section-header section-header--compact">
        <div class="section-label section-label--compact">Services</div>
        <h2 class="section-title section-title--compact">3つの専門分野でサポート</h2>
        <p class="section-desc section-desc--compact">IT・データ・経営財務を横断的に支援できるのが強みです</p>
      </div>
      <div class="service-grid">
        <div class="service-card">
          <div class="service-number">01</div>
          <h3>DX推進・IT戦略</h3>
          <p class="service-desc">デジタル技術を活用した業務改善・競争力強化を支援します。</p>
          <ul>
            <li>DX推進サポート</li>
            <li>IT戦略策定支援</li>
            <li>生成AI導入支援</li>
            <li>Webサイト・アプリ開発</li>
          </ul>
          <a href="/services/#dx" class="service-link">詳しく見る <ArrowIcon size={14} /></a>
        </div>
        <div class="service-card">
          <div class="service-number">02</div>
          <h3>データ活用</h3>
          <p class="service-desc">経営データを分析し、意思決定を支援する仕組みを構築します。</p>
          <ul>
            <li>経営データ分析</li>
            <li>KPIダッシュボード構築</li>
            <li>業務プロセスの可視化</li>
          </ul>
          <a href="/services/#data" class="service-link">詳しく見る <ArrowIcon size={14} /></a>
        </div>
        <div class="service-card">
          <div class="service-number">03</div>
          <h3>経営・財務支援</h3>
          <p class="service-desc">経営診断から資金調達まで、経営基盤の強化を支援します。</p>
          <ul>
            <li>経営診断・改善提案</li>
            <li>補助金申請サポート</li>
            <li>記帳代行・経理支援</li>
          </ul>
          <a href="/services/#management" class="service-link">詳しく見る <ArrowIcon size={14} /></a>
        </div>
      </div>
      <div class="services-all">
        <a href="/services/" class="btn-secondary" data-track-cta="services">すべてのサービスを見る <ArrowIcon size={14} /></a>
      </div>
    </div>
  </section>

  <!-- WHY ME -->
  <section class="why-me">
    <div class="why-me-container">
      <div class="section-header section-header--compact">
        <div class="section-label section-label--compact">Why Choose Me</div>
        <h2 class="section-title section-title--compact">選ばれる3つの理由</h2>
        <p class="section-desc section-desc--compact">専門性と実務経験の両方を活かし、実行可能な支援を提供します</p>
      </div>
      <div class="why-grid">
        <div class="why-card">
          <div class="why-number">01</div>
          <h3>IT×経営×財務の複合スキル</h3>
          <p>システム開発から経営診断、財務分析まで一貫して対応。部分最適ではなく、全体最適な提案ができます。</p>
        </div>
        <div class="why-card">
          <div class="why-number">02</div>
          <h3>伴走型の支援スタイル</h3>
          <p>提案だけでなく、実装・運用まで一緒に取り組みます。「絵に描いた餅」で終わらせません。</p>
        </div>
        <div class="why-card">
          <div class="why-number">03</div>
          <h3>わかりやすいコミュニケーション</h3>
          <p>専門用語を使わず、経営者目線でご説明します。「何を聞いていいかわからない」という方も安心してご相談ください。</p>
        </div>
      </div>
    </div>
  </section>

  <!-- BLOG -->
  {latestPosts.length > 0 && (
    <section class="section blog" id="blog">
      <div class="container">
        <div class="section-header section-header--compact">
          <div class="section-label section-label--compact">Blog</div>
          <h2 class="section-title section-title--compact">ブログ・お役立ち情報</h2>
        </div>
        <div class="blog-cards">
          {latestPosts.map((post) => {
            const cat = getPrimaryCategory(post.category);
            return (
              <a href={`/blog/${post.slug || post.id}/`} class="blog-card-home">
                {post.thumbnail ? (
                  <div class="blog-card-home__thumbnail">
                    <img
                      src={`${post.thumbnail.url}?w=640&h=360&fit=crop`}
                      alt={post.title}
                      width="640"
                      height="360"
                      loading="lazy"
                      decoding="async"
                    />
                  </div>
                ) : (
                  <div class="blog-card-home__thumbnail blog-card-home__thumbnail--empty">
                    <span>{categoryIcons[cat]}</span>
                  </div>
                )}
                <div class="blog-card-home__body">
                  <span class="blog-card-home__category">{categoryIcons[cat]} {categoryLabels[cat]}</span>
                  <h3 class="blog-card-home__title">{post.title}</h3>
                  <time class="blog-card-home__date" datetime={post.publishedAt}>{formatDate(post.publishedAt)}</time>
                </div>
              </a>
            );
          })}
        </div>
        <div class="blog-more">
          <a href="/blog/" class="btn-secondary" data-track-cta="blog">ブログをもっと見る <ArrowIcon size={14} /></a>
        </div>
      </div>
    </section>
  )}

  <!-- CTA -->
  <section class="section cta">
    <div class="cta-inner">
      <h2 class="cta-title">まずはお気軽にご相談ください</h2>
      <p class="cta-desc">
        「こんなこと相談していいのかな？」という内容でも大歓迎です。<br>
        初回30分の無料相談で、御社の課題を一緒に整理しましょう。
      </p>
      <a href="/contact/" class="btn-primary" data-track-cta="bottom">無料相談を予約する <ArrowIcon size={14} /></a>
      <p class="cta-note">※ 相談だけでも問題ありません。押し売りは一切いたしません。</p>
    </div>
  </section>

  <!-- GTM: Track problem card clicks (CTA tracking handled globally by Layout) -->
  <script>
    import { trackProblemClick } from '../lib/analytics';

    document.querySelectorAll<HTMLAnchorElement>('.problem-card').forEach(el => {
      el.addEventListener('click', (e) => {
        e.preventDefault();
        const text = el.querySelector('.problem-text')?.textContent?.trim() || '';
        trackProblemClick(text, el.href);
      });
    });
  </script>
</Layout>

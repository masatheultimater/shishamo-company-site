---
import Layout from '../../layouts/Layout.astro';
import FAQSection from '../../components/ui/FAQSection.astro';
import { externalAPIs } from '../../lib/siteConfig';
import { Icon } from 'astro-icon/components';
import '../../styles/forms.css';

const FORMSPREE_ENDPOINT = externalAPIs.formspreeEndpoint;

const quoteFAQ = [
  { question: '見積もりは本当に無料ですか？', answer: 'はい、お見積もりは完全無料です。ご契約に至らなかった場合でも費用は一切かかりません。' },
  { question: '見積もりにはどのくらい時間がかかりますか？', answer: '通常3営業日以内にご連絡いたします。内容によってはヒアリングをお願いする場合があります。' },
  { question: '予算が決まっていなくても依頼できますか？', answer: 'もちろんです。ご予算が未定の場合は、複数のプランをご提案いたします。ご予算に応じて調整も可能です。' },
  { question: '料金体系を教えてください', answer: 'サービスによって異なります。月額制、プロジェクト単位、時間単位など、ご要望に応じて柔軟に対応いたします。詳細は<a href="/services/">サービスページ</a>をご覧ください。' },
  { question: 'まずは相談だけしたいのですが', answer: '具体的なプロジェクトがまだ決まっていない場合は、<a href="/contact/">無料相談</a>からお申し込みください。課題の整理からお手伝いします。' },
];
---

<Layout
  title="お見積もり依頼 | ししゃもカンパニー"
  description="具体的なプロジェクトのお見積もりをご希望の方はこちらからお申し込みください。DX推進・生成AI導入・データ活用・経営支援のお見積もりは無料です。"
  currentPage="contact"
>
  <section class="page-header">
    <p class="page-header-label">Quote Request</p>
    <h1>お見積もり依頼</h1>
    <p>具体的なプロジェクトのお見積もりをご希望の方はこちらからお申し込みください。</p>
  </section>

  <section class="contact-section">
    <div class="contact-inner">
      <div class="contact-form-card">
        <h2>お見積もりを依頼する</h2>
        <p>以下のフォームにプロジェクトの詳細をご記入ください。内容を確認の上、ご連絡いたします。</p>
        <form action={FORMSPREE_ENDPOINT} method="POST" id="quoteForm">
          <input type="hidden" name="form_type" value="quote">
          <input type="hidden" name="_subject" value="【ししゃも】お見積り依頼">

          <div class="form-group">
            <label for="quote-name">
              お名前<span class="required" aria-hidden="true">*</span>
              <span class="sr-only">（必須）</span>
            </label>
            <input type="text" id="quote-name" name="name" required aria-required="true" placeholder="山田 太郎">
          </div>

          <div class="form-group">
            <label for="quote-company">
              会社名<span class="required" aria-hidden="true">*</span>
              <span class="sr-only">（必須）</span>
            </label>
            <input type="text" id="quote-company" name="company" required aria-required="true" placeholder="株式会社〇〇">
          </div>

          <div class="form-group">
            <label for="quote-email">
              メールアドレス<span class="required" aria-hidden="true">*</span>
              <span class="sr-only">（必須）</span>
            </label>
            <input type="email" id="quote-email" name="email" required aria-required="true" placeholder="example@company.com">
          </div>

          <div class="form-group">
            <label for="quote-phone">電話番号</label>
            <input type="tel" id="quote-phone" name="phone" placeholder="03-1234-5678">
          </div>

          <div class="form-group">
            <label for="quote-category">
              依頼したいサービス<span class="required" aria-hidden="true">*</span>
              <span class="sr-only">（必須）</span>
            </label>
            <select id="quote-category" name="category" required aria-required="true">
              <option value="">選択してください</option>
              <option value="dx-consulting">DX推進サポート</option>
              <option value="it-strategy">IT戦略策定</option>
              <option value="ai-consulting">生成AI導入支援</option>
              <option value="ai-tool">AIツール開発</option>
              <option value="data-analysis">経営データ分析</option>
              <option value="dashboard">KPIダッシュボード構築</option>
              <option value="web-development">Webサイト・アプリ構築</option>
              <option value="management">経営診断・改善提案</option>
              <option value="subsidy">補助金申請サポート</option>
              <option value="accounting">記帳代行・経理支援</option>
              <option value="multiple">複数サービスの組み合わせ</option>
              <option value="other">その他</option>
            </select>
          </div>

          <div class="form-group">
            <label for="quote-deadline">希望納期</label>
            <select id="quote-deadline" name="deadline">
              <option value="">選択してください</option>
              <option value="asap">できるだけ早く</option>
              <option value="1month">1ヶ月以内</option>
              <option value="3months">3ヶ月以内</option>
              <option value="6months">半年以内</option>
              <option value="1year">1年以内</option>
              <option value="flexible">特に急いでいない</option>
            </select>
          </div>

          <div class="form-group">
            <label for="quote-budget">予算感</label>
            <select id="quote-budget" name="budget">
              <option value="">選択してください</option>
              <option value="under30">30万円未満</option>
              <option value="30-50">30万円〜50万円</option>
              <option value="50-100">50万円〜100万円</option>
              <option value="100-300">100万円〜300万円</option>
              <option value="300-500">300万円〜500万円</option>
              <option value="over500">500万円以上</option>
              <option value="undecided">未定・相談したい</option>
            </select>
            <p class="form-note">あくまで目安です。ご予算に応じたご提案をいたします。</p>
          </div>

          <div class="form-group">
            <label for="quote-project">
              プロジェクト概要<span class="required" aria-hidden="true">*</span>
              <span class="sr-only">（必須）</span>
            </label>
            <textarea id="quote-project" name="project_overview" class="large" required aria-required="true" placeholder="実現したいこと、現在の課題、プロジェクトの背景などをできるだけ詳しくお書きください。"></textarea>
            <p class="form-note">詳しくご記入いただくほど、正確なお見積もりが可能です。</p>
          </div>

          <div class="form-group">
            <label for="quote-additional">その他ご要望・ご質問</label>
            <textarea id="quote-additional" name="additional_notes" placeholder="気になる点やご質問があればお書きください。"></textarea>
          </div>

          <div class="form-group">
            <div class="checkbox-group">
              <input type="checkbox" id="privacy" name="privacy" required>
              <label for="privacy"><a href="/privacy-policy/" target="_blank" rel="noopener noreferrer">プライバシーポリシー</a>に同意する</label>
            </div>
          </div>

          <button type="submit" class="btn-primary quote-submit-btn">
            お見積もりを依頼する
            <Icon name="ri:arrow-right-line" size={14} />
          </button>
        </form>
        <script>
          import { trackFormSubmit, initFormAbandonmentTracking } from '../../lib/analytics';
          const form = document.getElementById('quoteForm') as HTMLFormElement | null;
          form?.addEventListener('submit', async (e) => {
            e.preventDefault();
            trackFormSubmit({ form_type: 'quote' });
            const btn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
            const originalText = btn?.innerHTML || '';
            if (btn) { btn.disabled = true; btn.textContent = '送信中...'; }
            try {
              const res = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'Accept': 'application/json' },
              });
              if (res.ok) {
                window.location.href = '/contact/thanks/';
              } else {
                alert('送信に失敗しました。もう一度お試しください。');
                if (btn) { btn.disabled = false; btn.innerHTML = originalText; }
              }
            } catch {
              alert('送信に失敗しました。もう一度お試しください。');
              if (btn) { btn.disabled = false; btn.innerHTML = originalText; }
            }
          });
          initFormAbandonmentTracking('quoteForm', 'quote');
        </script>
      </div>

      <div class="contact-sidebar">
        <div class="sidebar-card response-card">
          <h3>
            <Icon name="ri:clipboard-line" class="response-icon" size={18} />
            見積もり無料
          </h3>
          <div class="response-time">0円</div>
          <p>お見積もりは無料です</p>
        </div>

        <div class="sidebar-card">
          <h3>
            <Icon name="ri:chat-3-line" size={18} />
            詳細ヒアリング
          </h3>
          <p>いただいた内容をもとに、必要に応じてオンラインでヒアリングさせていただきます。</p>
        </div>

        <div class="sidebar-card">
          <h3>
            <Icon name="ri:check-double-line" size={18} />
            具体的な提案
          </h3>
          <p>ご予算・ご要望に応じた最適なプランをご提案。実現可能な範囲で柔軟に対応します。</p>
        </div>

        <div class="sidebar-card">
          <h3>
            <Icon name="ri:flashlight-line" size={18} />
            返信目安
          </h3>
          <p>3営業日以内にお見積もりまたはヒアリングのご連絡をいたします。</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ SECTION -->
  <FAQSection title="お見積もりについてよくあるご質問" items={quoteFAQ} variant="detailed" generateSchema />
</Layout>

<style>
  /* Page Header */
  .page-header {
    padding: 120px 24px 60px;
    text-align: center;
    position: relative;
  }
  .page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-semantic-accent);
  }
  .page-header-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-bottom: 10px;
  }
  .page-header h1 {
    font-family: var(--font-display);
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 12px;
  }
  .page-header p {
    font-size: 15px;
    color: var(--color-text-secondary);
    max-width: 520px;
    margin: 0 auto;
    line-height: 1.7;
  }

  /* Contact Section */
  .contact-section {
    padding: 60px 24px 80px;
    background: var(--color-bg-secondary);
  }
  .contact-inner {
    max-width: 1000px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap: 32px;
  }

  /* Form Card */
  .contact-form-card {
    background: var(--color-card-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 32px;
    box-shadow: var(--shadow-semantic-md);
  }
  .contact-form-card h2 {
    font-family: var(--font-display);
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .contact-form-card > p {
    color: var(--color-text-secondary);
    font-size: 14px;
    margin-bottom: 28px;
  }

  /* Quote form overrides (base styles from forms.css) */
  .contact-form-card {
    --form-gap: 20px;
    --form-border-width: 1px;
    --form-input-padding: 12px 14px;
    --form-input-font-size: 15px;
    --form-label-size: 14px;
  }
  .form-group textarea.large {
    min-height: 200px;
  }
  .form-group select {
    cursor: pointer;
  }
  .form-note {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin-top: 6px;
  }
  .checkbox-group {
    gap: 10px;
  }
  .checkbox-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
  }
  .checkbox-group label {
    font-size: 14px;
    color: var(--color-text-secondary);
  }

  .quote-submit-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: var(--color-accent);
    color: var(--palette-white);
    padding: 14px 28px;
    border-radius: var(--radius-sm);
    font-weight: 600;
    font-size: 15px;
    transition: all 0.2s;
    border: none;
    cursor: pointer;
    width: 100%;
  }
  .quote-submit-btn:hover {
    opacity: 0.9;
    box-shadow: var(--shadow-semantic-glow);
  }
  .quote-submit-btn svg {
    transition: transform 0.2s;
  }
  .quote-submit-btn:hover svg {
    transform: translateX(4px);
  }

  /* Sidebar */
  .contact-sidebar {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .sidebar-card {
    background: var(--color-card-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: 20px;
    transition: all 0.2s;
  }
  .sidebar-card:hover {
    border-color: var(--color-accent);
  }
  .sidebar-card h3 {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .sidebar-card h3 :global(svg) {
    color: var(--color-accent);
    flex-shrink: 0;
  }
  .sidebar-card p {
    font-size: 13px;
    color: var(--color-text-secondary);
    line-height: 1.7;
  }

  /* Response Card */
  .response-card {
    background: var(--color-accent);
    color: var(--palette-white);
    border: none;
    position: relative;
    overflow: hidden;
  }
  .response-card::before {
    content: '';
    position: absolute;
    right: -20px;
    top: -20px;
    width: 100px;
    height: 100px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
  }
  .response-card h3 {
    color: var(--palette-white);
  }
  .response-card .response-icon {
    color: rgba(255, 255, 255, 0.8);
  }
  .response-time {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 700;
    margin: 8px 0;
  }
  .response-card p {
    opacity: 0.9;
    color: var(--palette-white);
  }
  .response-card:hover {
    border-color: transparent;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .contact-inner {
      grid-template-columns: 1fr;
      gap: 24px;
    }
    .contact-sidebar {
      order: -1;
      flex-direction: row;
      flex-wrap: wrap;
    }
    .sidebar-card {
      flex: 1;
      min-width: 200px;
    }
  }

  @media (max-width: 768px) {
    .page-header {
      padding: 96px 24px 48px;
    }
    .page-header h1 {
      font-size: 26px;
    }
    .contact-section {
      padding: 40px 24px 60px;
    }
    .contact-form-card {
      padding: 24px 20px;
    }
    .contact-sidebar {
      flex-direction: column;
    }
    .sidebar-card {
      min-width: auto;
    }
  }

  @media (max-width: 480px) {
    .page-header {
      padding: 88px 16px 40px;
    }
    .page-header h1 {
      font-size: 24px;
    }
    .contact-section {
      padding: 32px 16px 48px;
    }
    .contact-form-card {
      padding: 20px 16px;
    }
    .contact-form-card h2 {
      font-size: 18px;
    }
  }
</style>
